---
title: "Evening Session: Using _R_ and _Bioconductor_ with _Docker_"
author: Nitesh Turaga
output:
  BiocStyle::html_document:
    toc: true
vignette: >
  % \VignetteEngine{knitr::rmarkdown}
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
```

```{r setup, echo=FALSE}
knitr::opts_chunk$set(
    eval = as.logical(Sys.getenv("KNITR_EVAL", "TRUE")),
    cache = as.logical(Sys.getenv("KNITR_CACHE", "TRUE"))
)
```

# The problem

You may have come up with some of the following issues:

1. you want to use software that doesn’t exist for the operating system (Mac, Windows, Linux) you’d prefer.

2. you struggle with installing a software tool because you have to install a number of other dependencies first. 
   Those dependencies, in turn, require other things, and so on (i.e. combinatoric explosion).

3. the software you’re setting up involves many dependencies and only a subset of all possible versions of those
 dependencies actually works as desired.

4. you’re not actually sure what version of the software you’re using because the install process was so circuitous.

5. you and a colleague are using the same software but get different results because you have installed different versions
  and/or are using different operating systems.

6. Package installations take FOREVER! 


# What is Docker?

Docker enables you to separate your applications from your infrastructure. Containers and 
virtual machines have similar resource isolation and allocation benefits, but function differently
because containers virtualize the operating system instead of hardware. Containers are more portable
and efficient.

Deliver multiple applications hassle free and have them run the same way on all your environments 
including design, testing, staging and production – desktop or cloud-native.

NOTE: Another way to think about the same concept

Think of an operating system as two primary components, the **kernel space**, and the **user space**. 
The **Kernel** talks to the hardware, and provides core system features.  The **user space** is the 
environment where applications, libraries and system services run. Traditionally you  use an operating 
system that has a fixed combination of kernel and user space.  Containers change the user space into a 
swappable component. 


# Install Docker

Install docker if you don't already have it on your machine: 

https://docs.docker.com/get-docker/

*NOTE*: This takes a while, so ask me questions tomorrow if you are unable to get any of this going.

# Why use Docker for Bioconductor?

- Easy install of packages 

# How to use Docker for Bioconductor?

# What are the current Bioconductor containers available?

**Stable release** of Bioconductor - R 4.2.0 , Bioc 3.15.0

`bioconductor/bioconductor_docker:RELEASE_X_Y`

**Development version** - R 4.2.0, Bioc 3.16.0

`bioconductor/bioconductor_docker:devel`

# Using Bioconductor docker containers

## Basics 

Run the docker container

```
docker run \
     -e PASSWORD=bioc \
     -p 8787:8787 \
     bioconductor/bioconductor_docker:devel
```

## Mount volumes 


## Run the docker image with docker-compose

```
docker-compose up
```

## Extend docker images

### Example docker image

```
docker pull nitesh1989/bioconductor_msmb:RELEASE_3_15
```

## Singularity

Singularity was created to run complex applications on HPC clusters in a simple, portable, and reproducible way.

Advantages: 


Doing the same thing as above using Singularity:

### Run

### Mount 


## Resources and links

https://bioconductor.org/help/docker/ 

https://hub.docker.com/r/bioconductor/bioconductor_docker

